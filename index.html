<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webaidea - سوق التجار الإلكتروني</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- إضافة مكتبة Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- شريط التنقل العلوي -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">Webaidea</a>
            <div class="nav-links">
                <a href="#products">المنتجات</a>
                <a href="#how-it-works">كيفية العمل</a>
                <a href="javascript:void(0);" class="btn-contact" onclick="redirectToInstagram()">
                    <i class="fas fa-bullhorn"></i> التواصل لنشر إعلانك
                </a>
                <!-- زر تسجيل الدخول الرئيسي -->
                <a href="javascript:void(0);" class="login-btn" onclick="openAuthModal()">
                    <i class="fas fa-user"></i> تسجيل دخول
                </a>
                <!-- زر دخول الإدارة (سيكون مخفي وستظهر عند تسجيل دخول المدير) -->
                <a href="javascript:void(0);" id="adminDashboardBtn" class="admin-dashboard-btn" style="display: none;" onclick="showAdminPanel()">
                    <i class="fas fa-cogs"></i> لوحة الإدارة
                </a>
                <!-- زر الخروج (سيكون مخفي وستظهر عند تسجيل دخول أي مستخدم) -->
                <a href="javascript:void(0);" id="logoutBtn" class="logout-btn" style="display: none;" onclick="logoutUser()">
                    <i class="fas fa-sign-out-alt"></i> تسجيل خروج
                </a>
            </div>
            <button class="menu-toggle" onclick="toggleMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- نموذج تسجيل الدخول / تسجيل جديد -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">تسجيل الدخول</h2>
            <form id="authForm" onsubmit="handleAuth(event)">
                <div class="form-group">
                    <label for="email">البريد الإلكتروني</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="password">كلمة المرور</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div class="form-group" id="nameField" style="display: none;">
                    <label for="name">الاسم الكامل</label>
                    <input type="text" id="name" name="name">
                </div>
                <button type="submit" class="btn-submit" id="submitBtn">دخول</button>
            </form>
            <p class="switch-mode">
                <span id="switchText">ليس لديك حساب؟</span>
                <a href="javascript:void(0);" onclick="switchAuthMode()" id="switchLink">انشاء حساب جديد</a>
            </p>
        </div>
    </div>

    <!-- لوحة الإدارة (ستظهر فقط للمدير) -->
    <div id="adminPanel" class="admin-panel" style="display: none;">
        <div class="admin-header">
            <div class="admin-header-left">
                <button class="btn-back" onclick="goToMainSite()" title="العودة للقائمة الرئيسية">
                    <i class="fas fa-arrow-right"></i> العودة للرئيسية
                </button>
                <h2><i class="fas fa-cogs"></i> لوحة تحكم الإدارة</h2>
            </div>
            <button class="btn-logout" onclick="logoutAdmin()">
                تسجيل خروج <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
        <div class="admin-tabs">
            <button class="tab-link active" onclick="openAdminTab(event, 'tabMerchants')">التجار</button>
            <button class="tab-link" onclick="openAdminTab(event, 'tabAccounts')">الحسابات</button>
            <button class="tab-link" onclick="openAdminTab(event, 'tabAds')">الإعلانات المنشورة</button>
            <button class="tab-link" onclick="openAdminTab(event, 'tabPostAd')">نشر إعلان</button>
        </div>
        <div class="admin-content">
            <!-- تبويب التجار -->
            <div id="tabMerchants" class="tab-content active-tab">
                <h3><i class="fas fa-user-tie"></i> قائمة التجار المعتمدين</h3>
                <p>الحسابات التي يمكنها نشر الإعلانات.</p>
                <div class="search-box">
                    <input type="text" id="searchMerchant" placeholder="البحث عن تاجر بالبريد أو الاسم..." onkeyup="searchTable('merchantsTable', this.value)">
                    <i class="fas fa-search"></i>
                </div>
                <div class="table-container">
                    <table id="merchantsTable">
                        <thead>
                            <tr><th>الاسم</th><th>البريد الإلكتروني</th><th>تاريخ الانضمام</th><th>عدد الإعلانات</th><th>الإجراءات</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <!-- تبويب الحسابات -->
            <div id="tabAccounts" class="tab-content">
                <h3><i class="fas fa-users"></i> جميع الحسابات المسجلة</h3>
                <p>يمكنك ترقية أي حساب إلى "تاجر".</p>
                <div class="search-box">
                    <input type="text" id="searchAccount" placeholder="البحث عن حساب بالبريد..." onkeyup="searchTable('accountsTable', this.value)">
                    <i class="fas fa-search"></i>
                </div>
                <div class="table-container">
                    <table id="accountsTable">
                        <thead>
                            <tr><th>الاسم</th><th>البريد الإلكتروني</th><th>نوع الحساب</th><th>تاريخ التسجيل</th><th>الإجراءات</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <!-- تبويب الإعلانات -->
            <div id="tabAds" class="tab-content">
                <h3><i class="fas fa-list-alt"></i> جميع الإعلانات المنشورة</h3>
                <p>عرض جميع المنتجات المعروضة في الموقع.</p>
                <div class="search-box">
                    <input type="text" id="searchAd" placeholder="البحث في الإعلانات..." onkeyup="searchTable('adsTable', this.value)">
                    <i class="fas fa-search"></i>
                </div>
                <div class="table-container">
                    <table id="adsTable">
                        <thead>
                            <tr><th>صورة</th><th>اسم المنتج</th><th>السعر (ريال)</th><th>التاجر</th><th>تاريخ النشر</th><th>الإجراءات</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <!-- تبويب نشر إعلان جديد -->
            <div id="tabPostAd" class="tab-content">
                <h3><i class="fas fa-plus-circle"></i> نشر إعلان جديد (مميز)</h3>
                <p class="special-notice"><i class="fas fa-crown"></i> هذا الإعلان سيكون بارزًا ومميزًا في الصفحة الرئيسية. للنشر من قبل الإدارة فقط.</p>
                
                <form id="adminAdForm" onsubmit="postAdminAd(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="adTitle">عنوان المنتج *</label>
                            <input type="text" id="adTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="adPrice">السعر (ريال) *</label>
                            <input type="number" id="adPrice" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="adDescription">وصف المنتج *</label>
                        <textarea id="adDescription" rows="4" required></textarea>
                    </div>
                    
                    <!-- حقل رفع الصورة -->
                    <div class="form-group">
                        <label for="productImage">صورة المنتج *</label>
                        <div class="image-upload-container">
                            <input type="file" id="productImage" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                            <button type="button" class="upload-btn" onclick="document.getElementById('productImage').click()">
                                <i class="fas fa-upload"></i> اختر صورة
                            </button>
                            <div class="image-preview" id="imagePreview">
                                <i class="fas fa-image" style="font-size: 3rem; color: #ccc;"></i>
                                <p style="color: #999; margin-top: 10px;">لم يتم اختيار صورة</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="adContact">رقم التواصل *</label>
                        <input type="tel" id="adContact" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="adMerchant">الناشر (التاجر)</label>
                        <select id="adMerchant">
                            <option value="">-- اختر تاجر --</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn-submit"><i class="fas fa-paper-plane"></i> نشر الإعلان المميز</button>
                </form>
            </div>
        </div>
    </div>

    <!-- قسم الهيرو -->
    <header class="hero">
        <div class="hero-content">
            <h1>سوق <span class="highlight">ويب أيديا</span> للإعلانات</h1>
            <p>المنصة الأمثل للتجار لعرض منتجاتهم ووصولها لأكبر شريحة من العملاء. انشر إعلانك بكل سهولة بعد الموافقة الإدارية.</p>
            <div class="hero-buttons">
                <a href="#products" class="btn btn-primary">استعرض المنتجات</a>
                <a href="javascript:void(0);" class="btn btn-secondary" onclick="redirectToInstagram()">
                    اطلع نشر إعلان <i class="fab fa-instagram"></i>
                </a>
                <a href="javascript:void(0);" class="btn btn-primary" onclick="openAuthModal()">
                    <i class="fas fa-user-plus"></i> انشاء حساب جديد
                </a>
            </div>
        </div>
        <div class="hero-image">
            <img src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="منصة ويب أيديا">
        </div>
    </header>

    <!-- قسم المنتجات -->
    <section id="products" class="products-section">
        <div class="section-header">
            <h2>الإعلانات المنشورة</h2>
            <p>استعرض أحدث المنتجات المعروضة من قبل تجارنا المعتمدين.</p>
        </div>
        <div class="products-container" id="productsContainer"></div>
    </section>

    <!-- قسم كيفية العمل -->
    <section id="how-it-works" class="how-section">
        <h2>كيف تعمل المنصة؟</h2>
        <div class="steps">
            <div class="step">
                <div class="step-icon">1</div>
                <h3>انشاء حساب</h3>
                <p>سجل في الموقع ببياناتك الأساسية.</p>
                <a href="javascript:void(0);" onclick="openAuthModal()" style="color: #4361ee; font-weight: 600; margin-top: 10px; display: inline-block;">
                    <i class="fas fa-user-plus"></i> انشاء حساب الآن
                </a>
            </div>
            <div class="step">
                <div class="step-icon">2</div>
                <h3>التواصل لطلب النشر</h3>
                <p>اضغط على زر "التواصل لنشر إعلانك" للتواصل مع الإدارة عبر الإنستجرام.</p>
            </div>
            <div class="step">
                <div class="step-icon">3</div>
                <h3>انتظار الموافقة</h3>
                <p>ستقوم الإدارة بمراجعة طلبك وترقية حسابك إلى "تاجر".</p>
            </div>
            <div class="step">
                <div class="step-icon">4</div>
                <h3>بدء النشر</h3>
                <p>بعد الموافقة، يمكنك تسجيل الدخول وإضافة منتجاتك وعرضها للجميع.</p>
            </div>
        </div>
    </section>

    <!-- الفوتر -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">Webaidea</div>
            <p>منصة رائدة لتجارة إلكترونية آمنة ومنظمة. نربط التجار بالعملاء بثقة وسهولة.</p>
            <div class="footer-links">
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-facebook"></i></a>
            </div>
            <p class="copyright">© 2023 ويب أيديا. جميع الحقوق محفوظة.</p>
        </div>
    </footer>

    <!-- نافذة عرض المنتج بالتفصيل -->
    <div id="productDetailModal" class="modal detail-modal">
        <div class="modal-content detail-content">
            <span class="close-detail" onclick="closeDetailModal()">&times;</span>
            <div class="detail-body" id="detailBody"></div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>